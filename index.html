<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FutureBEE – POI Tagging MVP (OSM)</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <!-- OSM → GeoJSON converter for Overpass responses (relations/multipolygons supported) -->
  <script src="https://unpkg.com/osmtogeojson@3.0.0/osmtogeojson.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

  <link rel="stylesheet" href="style.css" />

  <!--
    The following script defines a global Cesium ion access token.  The value
    comes from the user and can be used to authenticate CesiumJS when you
    choose to integrate a 3D map or photorealistic terrain.  By keeping this
    token in a separate script block you avoid cluttering the rest of the
    application code.  When you decide to add Cesium support simply load
    the CesiumJS library (for example via https://unpkg.com/cesium/Build/Cesium/Cesium.js)
    and assign Cesium.Ion.defaultAccessToken to this token.  Until then
    the value is stored on the global window object for later use.
  -->
  <script>
    window.CESIUM_ION_ACCESS_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI1NmE1ZGMwYy0xNTQxLTRmMzgtYWM3NS0wYWUzMjk3MjNmYTAiLCJpZCI6MzYwODkxLCJpYXQiOjE3NjM0ODU3MTF9.D_qofjwKf6t1mnUO06Hkz-t7xr2UrPHklhG3a5Lfz8E';
  </script>
</head>
<body>
  <div id="app">
    <div id="map"></div>

    <aside id="panel">
      <header>
        <h1>POI Tagging (MVP)</h1>
        <div class="small">Click the map to add a POI. Tag → photo → solution → save.</div>
      </header>

      <div class="content">
        <div class="section">
          <h2>How this works <span class="badge">loop</span></h2>
          <div class="mini">
            Create tag → Add comments/tags → Fetch context → Find solutions → Map effects via feedback → Gain feedback → Improve scenarios
          </div>
        </div>

        <div class="section">
          <h2>Context layers <span class="badge">view</span></h2>
          <div id="layerToggles"></div>
        </div>

        <div class="section">
          <h2>POI</h2>
          <div class="mini">Active POI: <span id="poiId">—</span></div>

          <form id="poiForm" onsubmit="return false;">
            <label>Title (optional)</label>
            <input id="title" type="text" placeholder="e.g., Square feels empty" />

            <div class="row">
              <div>
                <label>Category</label>
                <select id="category"></select>
              </div>
              <div>
                <label>Urgency</label>
                <select id="urgency">
                  <option value="low">Low</option>
                  <option value="medium" selected>Medium</option>
                  <option value="high">High</option>
                </select>
              </div>
            </div>

            <label>Tags</label>
            <div id="tagChips" class="tags"></div>

            <label>Comment</label>
            <textarea id="comment" placeholder="What is the issue? Any constraints (e.g., cables/pipes, water-edge locked)?"></textarea>

            <hr/>

            <h2 style="margin:0 0 10px; font-size:13px;">Pictures</h2>
            <div class="preview">
              <div class="box">
                <div class="mini">Before (current)</div>
                <img id="beforePreview" alt="" />
                <label>Before photo URL</label>
                <input id="beforeUrl" type="text" placeholder="Paste image URL (optional)" />
                <label>or upload file</label>
                <input id="beforeFile" type="file" accept="image/*" />
              </div>
              <div class="box">
                <div class="mini">After (inspiration)</div>
                <img id="afterPreview" alt="" />
                <div class="mini">Selected: <span id="selectedAfterLabel">None</span></div>
              </div>
            </div>

            <hr/>

            <label>Solution template</label>
            <select id="solution"></select>

            <label>Solution note (optional)</label>
            <input id="solutionNote" type="text" placeholder="Short note (e.g., avoid underground cables)" />

            <label>Suggested images (click to select)</label>
            <div id="afterGrid" class="thumbgrid"></div>

            <hr/>

            <h2 style="margin:0 0 10px; font-size:13px;">Context snapshot</h2>
            <div id="contextBox" class="mini">Create a POI by clicking on the map.</div>

            <div class="btnbar">
              <button class="primary" id="btnSave">Save</button>
              <button id="btnNew" type="button">New</button>
              <button class="danger" id="btnDelete" type="button">Delete</button>
            </div>
          </form>
        </div>

        <div class="section">
          <h2>Data</h2>
          <div class="btnbar">
            <button id="btnExport" type="button">Export JSON</button>
            <button id="btnClearAll" type="button">Clear all</button>
          </div>
          <div class="mini" style="margin-top:10px;">Stored locally in your browser. Export JSON to share.</div>
        </div>
      </div>

      <div class="footer">
        <div class="pill" id="poiCount">0 POIs</div>
        <div class="pill" id="status">Loading…</div>
      </div>
    </aside>
  </div>

  <script src="app.js"></script>
</body>
</html>